## 3.2 GPU Pipeline Overview GPUç®¡çº¿æ¦‚è¿°

The GPU implements the conceptual geometry processing, rasterization, and pixel processing pipeline stages described in Chapter 2. These are divided into several hardware stages with varying degrees of configurability or programmability. Figure 3.2 shows the various stages color coded according to how programmable or configurable they are. Note that these physical stages are split up somewhat differently than the functional stages presented in Chapter 2.

GPU å®ç°ç¬¬ 2 ç« ä¸­æè¿°çš„æ¦‚å¿µæ€§å‡ ä½•å¤„ç†ã€å…‰æ …åŒ–å’Œåƒç´ å¤„ç†ç®¡çº¿é˜¶æ®µã€‚è¿™äº›é˜¶æ®µåˆ†ä¸ºå‡ ä¸ªå…·æœ‰ä¸åŒç¨‹åº¦çš„å¯é…ç½®æ€§æˆ–å¯ç¼–ç¨‹æ€§çš„ç¡¬ä»¶é˜¶æ®µã€‚ å›¾ 3.2 æ˜¾ç¤ºäº†æ ¹æ®å¯ç¼–ç¨‹æˆ–å¯é…ç½®æ€§ç”¨é¢œè‰²è¿›è¡ŒåŒºåˆ†çš„å„ä¸ªé˜¶æ®µã€‚ è¯·æ³¨æ„ï¼Œè¿™äº›ç‰©ç†é˜¶æ®µçš„åˆ’åˆ†ä¸ç¬¬ 2 ç« ä¸­ä»‹ç»çš„åŠŸèƒ½é˜¶æ®µæœ‰æ‰€ä¸åŒã€‚


![3.2](https://img-blog.csdnimg.cn/f605d3fdc2254f7090038c0f022aa964.png)


> Figure 3.2. GPU implementation of the rendering pipeline. The stages are color coded according to the degree of user control over their operation. Green stages are fully programmable. Dashed lines show optional stages. Yellow stages are configurable but not programmable, e.g., various blend modes can be set for the merge stage. Blue stages are completely fixed in their function.
>
> ä»å·¦åˆ°å³ä¾æ¬¡æ˜¯ï¼šé¡¶ç‚¹ç€è‰² ğŸ‘‰ æ›²é¢ç»†åˆ† ğŸ‘‰ å‡ ä½•ç€è‰² ğŸ‘‰ å‰ªè£ ğŸ‘‰ å±å¹•æ˜ å°„ ğŸ‘‰ ä¸‰è§’å½¢è®¾ç½®/ä¸‰è§’å½¢éå† ğŸ‘‰ åƒç´ ç€è‰² ğŸ‘‰ åˆå¹¶
>
> å›¾ 3.2ï¼š æ¸²æŸ“ç®¡çº¿çš„ GPU å®ç°ã€‚ è¿™äº›é˜¶æ®µæ ¹æ®ç”¨æˆ·å¯¹å…¶æ“ä½œçš„æ§åˆ¶ç¨‹åº¦è¿›è¡Œé¢œè‰²ç¼–ç ã€‚ ç»¿è‰²é˜¶æ®µæ˜¯å®Œå…¨å¯ç¼–ç¨‹çš„ã€‚ è™šçº¿è¡¨ç¤ºå¯é€‰é˜¶æ®µã€‚ é»„è‰²é˜¶æ®µæ˜¯å¯é…ç½®(configurable)çš„ä½†ä¸æ˜¯å¯ç¼–ç¨‹çš„ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥ä¸ºåˆå¹¶é˜¶æ®µ(merge stage)è®¾ç½®å„ç§æ··åˆæ¨¡å¼(blend modes)ã€‚ è“è‰²é˜¶æ®µçš„åŠŸèƒ½å®Œå…¨å›ºå®š(fixed)ã€‚

We describe here the logical model of the GPU, the one that is exposed to you as a programmer by an API. As Chapters 18 and 23 discuss, the implementation of this logical pipeline, the physical model, is up to the hardware vendor. A stage that is fixed-function in the logical model may be executed on the GPU by adding commands to an adjacent programmable stage. A single program in the pipeline may be split into elements executed by separate sub-units, or be executed by a separate pass entirely. The logical model can help you reason about what affects performance, but it should not be mistaken for the way the GPU actually implements the pipeline.

æˆ‘ä»¬åœ¨è¿™é‡Œæè¿°äº† GPU çš„é€»è¾‘æ¨¡å‹ï¼Œå³é€šè¿‡ API å‘ç¨‹åºå‘˜å±•ç¤ºçš„æ¨¡å‹ã€‚ æ­£å¦‚ç¬¬ 18 ç« å’Œç¬¬ 23 ç« æ‰€è®¨è®ºçš„ï¼Œè¿™ä¸ªé€»è¾‘ç®¡é“ã€ç‰©ç†æ¨¡å‹çš„å®ç°å–å†³äºç¡¬ä»¶ä¾›åº”å•†ã€‚ é€šè¿‡å‘ç›¸é‚»çš„å¯ç¼–ç¨‹é˜¶æ®µæ·»åŠ å‘½ä»¤ï¼Œå¯ä»¥åœ¨ GPU ä¸Šæ‰§è¡Œé€»è¾‘æ¨¡å‹ä¸­å›ºå®šåŠŸèƒ½(fixed-function)çš„é˜¶æ®µã€‚ ç®¡çº¿ä¸­çš„å•ä¸ªç¨‹åºå¯ä»¥æ‹†åˆ†ä¸ºç”±å•ç‹¬çš„å­å•å…ƒä»¬æ‰§è¡Œçš„å…ƒç´ ï¼Œæˆ–è€…å®Œå…¨ç”±å•ç‹¬çš„é€šé“æ‰§è¡Œã€‚ é€»è¾‘æ¨¡å‹å¯ä»¥å¸®åŠ©æ‚¨æ¨æ–­å½±å“æ€§èƒ½çš„å› ç´ ï¼Œä½†ä¸åº”å°†å…¶è¯¯è®¤ä¸ºæ˜¯ GPU å®é™…å®ç°ç®¡çº¿çš„æ–¹å¼ã€‚

The vertex shader is a fully programmable stage that is used to implement the geometry processing stage. The geometry shader is a fully programmable stage that operates on the vertices of a primitive (point, line, or triangle). It can be used to perform per-primitive shading operations, to destroy primitives, or to create new ones. The tessellation stage and geometry shader are both optional, and not all GPUs support them, especially on mobile devices.

é¡¶ç‚¹ç€è‰²å™¨æ˜¯ä¸€ä¸ªå®Œå…¨å¯ç¼–ç¨‹çš„é˜¶æ®µï¼Œç”¨äºå®ç°å‡ ä½•å¤„ç†é˜¶æ®µã€‚ å‡ ä½•ç€è‰²å™¨æ˜¯ä¸€ä¸ªå®Œå…¨å¯ç¼–ç¨‹çš„é˜¶æ®µï¼Œå®ƒåœ¨å›¾å…ƒï¼ˆç‚¹ã€çº¿æˆ–ä¸‰è§’å½¢ï¼‰çš„é¡¶ç‚¹ä¸Šè¿è¡Œã€‚ å®ƒå¯ç”¨äºæ‰§è¡Œæ¯ä¸ªå›¾å…ƒçš„ç€è‰²æ“ä½œã€é”€æ¯å›¾å…ƒæˆ–åˆ›å»ºæ–°å›¾å…ƒã€‚ æ›²é¢ç»†åˆ†é˜¶æ®µå’Œå‡ ä½•ç€è‰²å™¨éƒ½æ˜¯å¯é€‰çš„ï¼Œå¹¶éæ‰€æœ‰ GPU éƒ½æ”¯æŒå®ƒä»¬ï¼Œå°¤å…¶æ˜¯åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šã€‚

The clipping, triangle setup, and triangle traversal stages are implemented by fixed-function hardware. Screen mapping is affected by window and viewport settings, internally forming a simple scale and repositioning. The pixel shader stage is fully programmable. Although the merger stage is not programmable, it is highly configurable and can be set to perform a wide variety of operations. It implements the â€œmergingâ€ functional stage, in charge of modifying the color, z-buffer, blend, stencil, and any other output-related buffers. The pixel shader execution together with the merger stage form the conceptual pixel processing stage presented in Chapter 2.

è£å‰ªã€ä¸‰è§’å½¢è®¾ç½®(triangle setup)å’Œä¸‰è§’å½¢éå†é˜¶æ®µç”±å›ºå®šåŠŸèƒ½(fixed-function)ç¡¬ä»¶å®ç°ã€‚ å±å¹•æ˜ å°„å—çª—å£å’Œè§†å£(viewport)è®¾ç½®çš„å½±å“ï¼Œåœ¨å†…éƒ¨å½¢æˆç®€å•çš„ç¼©æ”¾(scale)å’Œé‡æ–°å®šä½(repositioning)ã€‚ åƒç´ ç€è‰²å™¨é˜¶æ®µæ˜¯å®Œå…¨å¯ç¼–ç¨‹çš„ã€‚ è™½ç„¶åˆå¹¶é˜¶æ®µ(merger stage)ä¸å¯ç¼–ç¨‹ï¼Œä½†å®ƒæ˜¯é«˜åº¦å¯é…ç½®çš„ï¼Œå¯ä»¥è®¾ç½®ä¸ºæ‰§è¡Œå„ç§å„æ ·çš„æ“ä½œã€‚ å®ƒå®ç°äº†â€œåˆå¹¶(merging)â€åŠŸèƒ½é˜¶æ®µï¼Œè´Ÿè´£ä¿®æ”¹é¢œè‰²ã€z ç¼“å†²åŒºã€æ··åˆã€æ¨¡æ¿å’Œä»»ä½•å…¶ä»–ä¸è¾“å‡ºç›¸å…³çš„ç¼“å†²åŒºã€‚ åƒç´ ç€è‰²å™¨æ‰§è¡Œä¸åˆå¹¶é˜¶æ®µä¸€èµ·æ„æˆäº†ç¬¬ 2 ç« ä¸­ä»‹ç»çš„æ¦‚å¿µæ€§åƒç´ å¤„ç†é˜¶æ®µã€‚

Over time, the GPU pipeline has evolved away from hard-coded operation and toward increasing flexibility and control. The introduction of programmable shader stages was the most important step in this evolution. The next section describes the features common to the various programmable stages.

éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒGPU ç®¡çº¿å·²ç»ä»ç¡¬ç¼–ç æ“ä½œæ¼”å˜ä¸ºå¢åŠ çµæ´»æ€§å’Œæ§åˆ¶ã€‚ å¯ç¼–ç¨‹ç€è‰²å™¨é˜¶æ®µçš„å¼•å…¥æ˜¯è¿™ä¸€æ¼”å˜è¿‡ç¨‹ä¸­æœ€é‡è¦çš„ä¸€æ­¥ã€‚ ä¸‹ä¸€èŠ‚å°†ä»‹ç»å„ç§å¯ç¼–ç¨‹é˜¶æ®µçš„å…±åŒç‰¹å¾ã€‚


